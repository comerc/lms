---
name: pitfalls-handling
description: Обеспечивает учет и описание подводных камней при разработке. Используйте при создании спецификаций, архитектурных решений, или сложных функций. Активируется автоматически при работе над новыми функциями.
allowed-tools: []
---

# Обработка подводных камней

## Обзор

Этот навык обеспечивает учет всех потенциальных проблем: доменных, технических и UX, чтобы избежать ошибок при реализации.

## Инструкции

<instructions>
  * ВСЕГДА создавай раздел "Подводные камни" в спецификациях
  * ВСЕГДА учитывай специфические для домена проблемы
  * ВСЕГДА описывай технические сложности и их решения
  * ВСЕГДА учитывай UX проблемы
  * ВСЕГДА предлагай конкретные решения для каждого подводного камня
</instructions>

## Категории подводных камней

### 1. Специфические для домена

**Примеры:**

- Премиум пользователи без скидки (нельзя применять промокоды)
- Существующие условия (нельзя изменить уже начатое задание)
- Ограничения по уровню (некоторые функции доступны только с определенного уровня)

**Решения:**

```typescript
// Проверка возможности применения скидки
function canApplyDiscount(user: User, promoCode: string): boolean {
  if (user.isPremium && !user.hasDiscount) {
    return false; // Премиум без скидки не может использовать промокоды
  }
  // другие проверки...
}
```

### 2. Технические сложности

**Виртуализация списков:**

- Проблема: Большие списки (1000+ элементов) замедляют рендеринг
- Решение: Использовать react-window или react-virtualized

```typescript
import { FixedSizeList } from 'react-window';

// Для списков с >100 элементами
<FixedSizeList height={600} itemCount={tasks.length} itemSize={80} width="100%">
  {TaskRow}
</FixedSizeList>;
```

**Устранение дребезга (debounce):**

- Проблема: Множественные запросы при вводе текста
- Решение: Debounce для поиска (500ms)

```typescript
import { debounce } from 'lodash';

const debouncedSearch = debounce((query: string) => {
  fetchTasks(query);
}, 500);
```

**Парсинг XML/JSON:**

- Проблема: Невалидные данные, отсутствующие поля
- Решение: Валидация и обработка ошибок

```typescript
function parseTaskData(data: unknown): Task | null {
  try {
    const task = taskSchema.parse(data); // Zod валидация
    return task;
  } catch (error) {
    console.error('Invalid task data:', error);
    return null;
  }
}
```

### 3. UX проблемы

**Подсказки с жаргоном:**

- Проблема: Технические термины непонятны школьникам
- Решение: Простые объяснения

```typescript
// Плохо: "Debounce interval для search query"
// Хорошо: "Задержка перед поиском: 0.5 секунды"

const tooltips = {
  debounce:
    'Поиск начнется автоматически через полсекунды после того, как вы перестанете печатать',
};
```

**Плотность информации:**

- Проблема: Слишком много информации на экране
- Решение: Прогрессивное раскрытие, группировка

**Когнитивная нагрузка:**

- Проблема: Слишком много вариантов выбора
- Решение: Умолчания, рекомендации, упрощение

### 4. Производительность

**Оптимизация рендеринга:**

```typescript
// Мемоизация компонентов
const TaskCard = React.memo(({ task }: { task: Task }) => {
  // ...
});

// Мемоизация вычислений
const filteredTasks = useMemo(() => {
  return tasks.filter(/* ... */);
}, [tasks, filters]);
```

**Lazy loading:**

```typescript
// Ленивая загрузка компонентов
const TaskModal = lazy(() => import('./TaskModal'));

// Ленивая загрузка данных
const { data, isLoading } = useQuery(['tasks', page], () => fetchTasks(page), {
  enabled: !!page,
});
```

## Примеры

### Ввод пользователя:

"Создай систему фильтрации с поиском"

### Ожидаемый вывод:

Спецификация с разделом "Подводные камни", включающим:

- Доменные: ограничения для премиум пользователей
- Технические: виртуализация, debounce, валидация
- UX: простые подсказки, упрощение интерфейса
- Производительность: мемоизация, lazy loading
